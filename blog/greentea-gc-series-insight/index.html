<!DOCTYPE html><html lang="en" class="dark"> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" href="/icon.png"><meta name="generator" content="Astro v5.5.2"><!-- Font preloads --><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Space+Mono:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet"><!-- Canonical URL --><link rel="canonical" href="https://alexrios.me/blog/greentea-gc-series-insight/"><!-- Primary Meta Tags --><title>Green Tea GC: The Insight | alexrios</title><meta name="title" content="Green Tea GC: The Insight"><meta name="description" content="Why Go's new garbage collector works with pages instead of objects—and what that means for your applications"><meta name="author" content="Alex Rios"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://alexrios.me/blog/greentea-gc-series-insight/"><meta property="og:title" content="Green Tea GC: The Insight"><meta property="og:description" content="Why Go's new garbage collector works with pages instead of objects—and what that means for your applications"><meta property="og:image" content="https://alexrios.me/og-image/greentea-gc-series-insight.png"><meta property="article:author" content="Alex Rios"><meta property="article:published_time" content="2026-01-14T03:00:00.000Z"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://alexrios.me/blog/greentea-gc-series-insight/"><meta property="twitter:title" content="Green Tea GC: The Insight"><meta property="twitter:description" content="Why Go's new garbage collector works with pages instead of objects—and what that means for your applications"><meta property="twitter:image" content="https://alexrios.me/og-image/greentea-gc-series-insight.png"><link rel="stylesheet" href="/_astro/about.BwEf0XJh.css">
<link rel="stylesheet" href="/_astro/about.DB3q__4j.css">
<style>li[data-astro-cid-zekvapgs]:before{content:"#";margin-right:-.5rem;color:var(--theme-accent)}.active-toc[data-astro-cid-zekvapgs]{color:var(--theme-accent)}
button[data-astro-cid-xuhzuiaq]{position:fixed;bottom:1rem;left:82%;display:none;height:3rem;width:3rem;align-items:center;justify-content:center;border-radius:9999px;background-color:var(--theme-accent);color:var(--theme-bg);--tw-shadow: 0 1px 3px 0 rgb(0 0 0 / .1), 0 1px 2px -1px rgb(0 0 0 / .1);--tw-shadow-colored: 0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow);transition-property:all;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}button[data-astro-cid-xuhzuiaq]:hover{--tw-scale-x: 1.25;--tw-scale-y: 1.25;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y));--tw-shadow: 0 20px 25px -5px rgb(0 0 0 / .1), 0 8px 10px -6px rgb(0 0 0 / .1);--tw-shadow-colored: 0 20px 25px -5px var(--tw-shadow-color), 0 8px 10px -6px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}@media (min-width: 640px){button[data-astro-cid-xuhzuiaq]{bottom:2rem;height:2.5rem;width:2.5rem}}@media (min-width: 768px){button[data-astro-cid-xuhzuiaq]{left:90%}}@media (min-width: 1536px){button[data-astro-cid-xuhzuiaq]{left:75%}}
</style></head> <body> <header class="group relative mb-8 flex justify-between items-center gap-4" id="main-header" data-astro-cid-3ef6ksr2> <div class="block" data-astro-cid-3ef6ksr2> <a class="title whitespace-nowrap" href="/" aria-current="false" data-astro-cid-3ef6ksr2>alexrios</a> </div> <nav class="mt-4 bg-surface/95 sm:bg-bgColor absolute hidden top-8 w-full sm:block sm:static sm:mt-0 group-[.menu-open]:z-50 group-[.menu-open]:flex group-[.menu-open]:bg-bgColor" id="navigation-menu" aria-label="main menu" data-astro-cid-3ef6ksr2> <div class="space-y-1 px-2 pb-3 pt-2 sm:flex sm:px-0 sm:py-0 sm:space-y-0 sm:space-x-2" data-astro-cid-3ef6ksr2> <a href="/" class="block py-2 sm:py-0" title="Home" aria-current="false" data-astro-prefetch="true" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> Home </a> <a href="/about" class="block py-2 sm:py-0" title="About" aria-current="false" data-astro-prefetch="true" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> About </a> <a href="/blog" class="block py-2 sm:py-0" title="Blog" aria-current="false" data-astro-prefetch="true" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> Blog </a> <a href="/books" class="block py-2 sm:py-0" title="Books" aria-current="false" data-astro-prefetch="true" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> Books </a> <a href="/speaker" class="block py-2 sm:py-0" title="Speaker" aria-current="false" data-astro-prefetch="true" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> Speaker </a> <a href="/archive" class="block py-2 sm:py-0" title="Archive" aria-current="false" data-astro-prefetch="true" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> Archive </a>  <a href="/tags" class="sm:hidden block py-2 sm:py-0" title="tags" aria-current="false" data-astro-prefetch="true" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> Tags </a>  <a href="/series" class="sm:hidden block py-2 sm:py-0" title="series" aria-current="false" data-astro-prefetch="true" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> Series </a>  </div> </nav> <div class="flex gap-2 items-center justify-center" data-astro-cid-3ef6ksr2> <button id="themeToggle" class="transition-all relative" aria-label="toggle theme" data-astro-cid-x3pjskd3> <svg width="25px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" data-astro-cid-x3pjskd3> <path class="sun opacity-100 transition-all dark:scale-0 dark:opacity-0" fill-rule="evenodd" d="M12 17.5a5.5 5.5 0 1 0 0-11 5.5 5.5 0 0 0 0 11zm0 1.5a7 7 0 1 0 0-14 7 7 0 0 0 0 14zm12-7a.8.8 0 0 1-.8.8h-2.4a.8.8 0 0 1 0-1.6h2.4a.8.8 0 0 1 .8.8zM4 12a.8.8 0 0 1-.8.8H.8a.8.8 0 0 1 0-1.6h2.5a.8.8 0 0 1 .8.8zm16.5-8.5a.8.8 0 0 1 0 1l-1.8 1.8a.8.8 0 0 1-1-1l1.7-1.8a.8.8 0 0 1 1 0zM6.3 17.7a.8.8 0 0 1 0 1l-1.7 1.8a.8.8 0 1 1-1-1l1.7-1.8a.8.8 0 0 1 1 0zM12 0a.8.8 0 0 1 .8.8v2.5a.8.8 0 0 1-1.6 0V.8A.8.8 0 0 1 12 0zm0 20a.8.8 0 0 1 .8.8v2.4a.8.8 0 0 1-1.6 0v-2.4a.8.8 0 0 1 .8-.8zM3.5 3.5a.8.8 0 0 1 1 0l1.8 1.8a.8.8 0 1 1-1 1L3.5 4.6a.8.8 0 0 1 0-1zm14.2 14.2a.8.8 0 0 1 1 0l1.8 1.7a.8.8 0 0 1-1 1l-1.8-1.7a.8.8 0 0 1 0-1z" data-astro-cid-x3pjskd3></path> <path class="moon opacity-0 transition-all dark:scale-100 dark:opacity-100" fill-rule="evenodd" d="M16.5 6A10.5 10.5 0 0 1 4.7 16.4 8.5 8.5 0 1 0 16.4 4.7l.1 1.3zm-1.7-2a9 9 0 0 1 .2 2 9 9 0 0 1-11 8.8 9.4 9.4 0 0 1-.8-.3c-.4 0-.8.3-.7.7a10 10 0 0 0 .3.8 10 10 0 0 0 9.2 6 10 10 0 0 0 4-19.2 9.7 9.7 0 0 0-.9-.3c-.3-.1-.7.3-.6.7a9 9 0 0 1 .3.8z" data-astro-cid-x3pjskd3></path> </svg> </button>  <script>
  const theme = (() => {
    if (typeof localStorage !== 'undefined' && localStorage.getItem('theme')) {
      return localStorage.getItem('theme');
    }
    if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
      return 'dark';
    }
      return 'light';
  })();

  if (theme === 'light') {
    document.documentElement.classList.remove('dark');
  } else {
    document.documentElement.classList.add('dark');
  }

  window.localStorage.setItem('theme', theme);

  const handleToggleClick = () => {
    const element = document.documentElement;
    element.classList.toggle("dark");

    const isDark = element.classList.contains("dark");
    localStorage.setItem("theme", isDark ? "dark" : "light");
  }

  document.getElementById("themeToggle").addEventListener("click", handleToggleClick);
</script> <nav-button data-astro-cid-3ef6ksr2="true"> <div class="sm:hidden" data-astro-cid-3ef6ksr2> <span class="sr-only" data-astro-cid-3ef6ksr2>open main menu</span> <button class="group flex items-center justify-center" type="button" id="navigation-menu-btn" aria-label="Open main menu" aria-expanded="false" aria-haspopup="menu" data-astro-cid-3ef6ksr2> <!-- icon when menu is closed --> <svg class="transform transition-all duration-150 ease-out group-aria-expanded:scale-0 group-aria-expanded:opacity-0 h-6 w-6 block group-aria-expanded:hidden" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-astro-cid-3ef6ksr2> <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" data-astro-cid-3ef6ksr2></path> </svg> <!-- icon when menu is open --> <svg class="transform transition-all duration-150 ease-out h-6 w-6 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100 hidden group-aria-expanded:block" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-astro-cid-3ef6ksr2> <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" data-astro-cid-3ef6ksr2></path> </svg> </button> </div> </nav-button> </div> </header>  <script type="module">class e extends HTMLElement{headerEl;mobileButtonEl;menuOpen;constructor(){super(),this.headerEl=document.getElementById("main-header"),this.mobileButtonEl=this.querySelector("button"),this.menuOpen=!1,this.mobileButtonEl.addEventListener("click",this.toggleMobileMenu)}toggleMobileMenu=()=>{this.headerEl.classList.toggle("menu-open"),this.menuOpen=!this.menuOpen,this.mobileButtonEl.setAttribute("aria-expanded",this.menuOpen.toString())}}customElements.define("nav-button",e);</script> <main class="grid grid-cols-1 gap-y-16 sm:grid-cols-[3fr_1fr] sm:gap-x-4">  <article class="cody-bg prose dark:prose-invert prose-cody text-textColor max-w-4xl"> <header class="space-y-2"> <div class="aspect-h-9 aspect-w-16 mb-6 w-full flex justify-center"> <img src="/green-tea.png" alt="green tea" class="m-0"> </div> <div class="md:sr-only not-sr-only"> <span>Part of series:</span> <a class="cody-link" href="/series/Green Tea GC">Green Tea GC</a> </div> <div class="flex gap-2 items-center"> <h1 class="text-3xl my-0">Green Tea GC: The Insight</h1>  </div> <span class="font-semibold text-textColor flex gap-2 items-center"> <time datetime="2026-01-14T03:00:00.000Z" title="14 January 2026"> 14 January 2026 </time> <span>
/ 6 min read </span>  </span> <ul class="not-prose flex gap-2 flex-wrap"> <svg viewBox="0 0 32 32" aria-hidden="true" focusable="false" class="w-5 h-5" astro-icon="carbon:tag-group"><circle cx="10" cy="14" r="2" fill="currentColor"/><path fill="currentColor" d="M16 30a1 1 0 0 1-.71-.29L4.59 19A2 2 0 0 1 4 17.59V10a2 2 0 0 1 2-2h7.59a2 2 0 0 1 1.41.59l10.71 10.7a1 1 0 0 1 0 1.42l-9 9A1 1 0 0 1 16 30zM6 10v7.59l10 10L23.59 20l-10-10z"/><path fill="currentColor" d="M27.71 13.29 17 2.59A2 2 0 0 0 15.59 2H8a2 2 0 0 0-2 2v2h2V4h7.59l10 10-1.3 1.29 1.42 1.42 2-2a1 1 0 0 0 0-1.42z"/></svg> <li class="tag"> <a href="/tags/go">go</a> </li><li class="tag"> <a href="/tags/runtime">runtime</a> </li><li class="tag"> <a href="/tags/gc">gc</a> </li><li class="tag"> <a href="/tags/performance">performance</a> </li> </ul> </header> <hr class="my-4"> <main class="prose-headings:font-semibold prose-headings:ml-4 prose-headings:before:absolute prose-headings:before:-ms-4 prose-headings:before:text-accent prose-headings:before:content-['#'] prose-th:before:content-none prose-a:text-accent">  <p><em>This is Part 1 of a series on Go’s Green Tea garbage collector. Part 2 will cover implementation. Part 3 will be about benchmarking. Part 4 will cover SIMD acceleration in Go 1.26.</em></p>
<hr>
<p>Somewhere in late 2024, Austin Clements was drinking matcha in Japan and prototyping a new garbage collector. The result ships as an experimental feature in Go 1.25 and becomes the default in 1.26.</p>
<p>They called it <strong>Green Tea GC</strong>.</p>
<p>The naming is whimsical. The insight behind it is not.</p>
<h2 id="the-problem-everyone-ignores">The problem everyone ignores</h2>
<p>Many teams throw hardware at GC problems. More cores. More RAM. Bigger GOGC values. These help, but they’re treating symptoms. The real issue is something optimization can’t fix: memory access patterns.</p>
<p>During the mark phase, the GC walks the heap following pointers. Object A points to object B points to object C. The algorithm is elegant. The memory access is chaos.</p>
<pre class="astro-code astro-code-themes catppuccin-mocha catppuccin-latte" style="background-color:#1e1e2e;--shiki-dark-bg:#eff1f5;color:#cdd6f4;--shiki-dark:#4c4f69; overflow-x: auto;" tabindex="0" data-language="lua"><code><span class="line"><span style="color:#CDD6F4;--shiki-dark:#4C4F69">Find object at </span><span style="color:#FAB387;--shiki-dark:#FE640B">0x1000</span></span>
<span class="line"><span style="color:#CDD6F4;--shiki-dark:#4C4F69">Jump to object at </span><span style="color:#FAB387;--shiki-dark:#FE640B">0x50000</span></span>
<span class="line"><span style="color:#CDD6F4;--shiki-dark:#4C4F69">Jump to object at </span><span style="color:#FAB387;--shiki-dark:#FE640B">0x2000</span></span>
<span class="line"><span style="color:#CDD6F4;--shiki-dark:#4C4F69">Jump to object at </span><span style="color:#FAB387;--shiki-dark:#FE640B">0x80000</span></span></code></pre>
<p>Each jump is a potential cache miss. L1 hit: ~4 cycles. L3 miss to RAM: ~100+ cycles. The GC spends most of its time <em>waiting for memory</em>.</p>
<p><a href="https://github.com/golang/go/issues/73581">The numbers</a> from the Go team:</p>
<ul>
<li><strong>~85%</strong> of GC time is in the scan loop</li>
<li><strong>>35%</strong> of CPU cycles are memory stalls</li>
</ul>
<p>That’s not a slow algorithm. That’s physics.</p>
<h2 id="the-non-solution-go-faster">The non-solution: go faster</h2>
<p>When something is slow, make it faster. SIMD. Prefetching. Parallelism. Unrolled loops.</p>
<p>Go has tried these. They help marginally. But here’s the thing: if 35% of your cycles are memory stalls, making your code 2x faster means you now spend… 35% of cycles on memory stalls. You’ve doubled compute throughput while memory bandwidth stays flat.</p>
<p>CPUs got faster exponentially. Memory got faster linearly. This is the <a href="https://en.wikipedia.org/wiki/Random-access_memory#Memory_wall"><strong>Memory Wall</strong></a>, and for many workloads, memory access patterns now dominate everything else.</p>
<p>You can’t optimize your way out of bad locality.</p>
<h2 id="the-insight-change-what-you-work-on">The insight: change what you work on</h2>
<p>Green Tea inverts the question. Instead of “which object should I scan next?”, it asks “which <em>memory region</em> should I scan next?”</p>
<p>Objects allocated around the same time tend to live near each other in memory. If you find one live object in an 8 KB span, there’s a good chance you’ll find more.</p>
<p>So don’t scan objects one at a time. Scan entire spans.</p>

























<table><thead><tr><th>Aspect</th><th>Previous GC</th><th>Green Tea GC</th></tr></thead><tbody><tr><td>Work unit</td><td>Individual objects</td><td>Spans (8 KB pages)</td></tr><tr><td>Memory access</td><td>Random, scattered</td><td>Sequential within spans</td></tr><tr><td>Cache behavior</td><td>Poor locality</td><td>~50% fewer cache misses</td></tr></tbody></table>
<p>When a live pointer is discovered:</p>
<ol>
<li>Mark the object as live</li>
<li>Enqueue the <em>entire span</em> for scanning</li>
<li>When the span is dequeued, scan all marked objects in that 8 KB block</li>
</ol>
<p>Sequential reads. Predictable access. The prefetcher can actually help. The cache stays warm.</p>
<h2 id="what-this-means-in-practice">What this means in practice</h2>
<p>The improvements are real but bounded:</p>





















<table><thead><tr><th>Metric</th><th>Improvement</th></tr></thead><tbody><tr><td>Cache misses</td><td>~50% reduction</td></tr><tr><td>GC CPU cost</td><td>10-40% reduction</td></tr><tr><td>Typical case</td><td>10% GC time reduction</td></tr></tbody></table>
<p>For an application spending 10% of time in GC, that’s 1-4% overall CPU reduction. Not transformative, but meaningful at scale.</p>
<p>The catch: Green Tea improves locality but can’t create it. Applications with inherently scattered allocation patterns (objects spread across many spans with no clustering) may see little benefit.</p>
<h2 id="the-status">The status</h2>
<ul>
<li><strong>Go 1.25</strong>: Experimental, enable with <code>GOEXPERIMENT=greenteagc</code></li>
<li><strong>Go 1.26</strong>: Default, opt-out with <code>GOEXPERIMENT=nogreenteagc</code></li>
</ul>
<p>It’s already running in production at Google.</p>
<h2 id="why-this-matters-beyond-gc">Why this matters beyond GC</h2>
<p>Green Tea is a case study in mechanical sympathy. The algorithm didn’t change. Tri-color marking is still tri-color marking. What changed is how the algorithm interacts with the hardware.</p>
<p>Austin Clements didn’t make the GC smarter. He made it friendlier to caches.</p>
<p>The same lesson applies to your code. When something is slow, the bottleneck is often not where you expect. Profile first. Sometimes the fastest code isn’t the cleverest. It’s the code that waits less.</p>
<hr>
<h2 id="appendix-the-hardware-concepts">Appendix: the hardware concepts</h2>
<p>If terms like “cache line” or “prefetcher” feel fuzzy, this section is for you.</p>
<h3 id="cache-your-cpus-short-term-memory">Cache: your CPU’s short-term memory</h3>
<p>RAM is far from the CPU. Fetching data from it takes ~100 nanoseconds, which sounds fast until you realize the CPU can execute hundreds of instructions in that time. So CPUs keep copies of recently used data in caches, small and fast memory banks sitting right next to the processor.</p>
<pre class="astro-code astro-code-themes catppuccin-mocha catppuccin-latte" style="background-color:#1e1e2e;--shiki-dark-bg:#eff1f5;color:#cdd6f4;--shiki-dark:#4c4f69; overflow-x: auto;" tabindex="0" data-language="lua"><code><span class="line"><span style="color:#CDD6F4;--shiki-dark:#4C4F69">CPU ←→ L1 </span><span style="color:#89B4FA;font-style:italic;--shiki-dark:#1E66F5;--shiki-dark-font-style:italic">cache</span><span style="color:#CDD6F4;--shiki-dark:#4C4F69"> (~</span><span style="color:#FAB387;--shiki-dark:#FE640B">4</span><span style="color:#CDD6F4;--shiki-dark:#4C4F69"> cycles) ←→ L2 </span><span style="color:#89B4FA;font-style:italic;--shiki-dark:#1E66F5;--shiki-dark-font-style:italic">cache</span><span style="color:#CDD6F4;--shiki-dark:#4C4F69"> (~</span><span style="color:#FAB387;--shiki-dark:#FE640B">12</span><span style="color:#CDD6F4;--shiki-dark:#4C4F69"> cycles) ←→ L3 </span><span style="color:#89B4FA;font-style:italic;--shiki-dark:#1E66F5;--shiki-dark-font-style:italic">cache</span><span style="color:#CDD6F4;--shiki-dark:#4C4F69"> (~</span><span style="color:#FAB387;--shiki-dark:#FE640B">40</span><span style="color:#CDD6F4;--shiki-dark:#4C4F69"> cycles) ←→ </span><span style="color:#89B4FA;font-style:italic;--shiki-dark:#1E66F5;--shiki-dark-font-style:italic">RAM</span><span style="color:#CDD6F4;--shiki-dark:#4C4F69"> (~</span><span style="color:#FAB387;--shiki-dark:#FE640B">100</span><span style="color:#94E2D5;--shiki-dark:#179299">+</span><span style="color:#CDD6F4;--shiki-dark:#4C4F69"> cycles)</span></span></code></pre>
<p>L1 is tiny (32-64 KB) but nearly instant. L3 is larger (megabytes) but slower. When the data you need isn’t in any cache, you wait for RAM. That wait is a <strong>cache miss</strong>.</p>
<h3 id="cache-lines-memory-comes-in-chunks">Cache lines: memory comes in chunks</h3>
<p>When the CPU fetches data from RAM, it doesn’t grab just the byte you asked for. It grabs a whole <strong>cache line</strong>, typically 64 bytes. If you read byte 0, bytes 1-63 come along for free.</p>
<p><strong>This is why sequential access is fast (and we love arrays)</strong>. Read an array element by element and you get one cache miss per 64 bytes. Jump around randomly and you get one cache miss per access.</p>
<pre class="astro-code astro-code-themes catppuccin-mocha catppuccin-latte" style="background-color:#1e1e2e;--shiki-dark-bg:#eff1f5;color:#cdd6f4;--shiki-dark:#4c4f69; overflow-x: auto;" tabindex="0" data-language="go"><code><span class="line"><span style="color:#6C7086;font-style:italic;--shiki-dark:#9CA0B0;--shiki-dark-font-style:italic">// Fast: sequential access, one cache miss per 64 bytes</span></span>
<span class="line"><span style="color:#CBA6F7;--shiki-dark:#8839EF">for</span><span style="color:#CDD6F4;--shiki-dark:#4C4F69"> i </span><span style="color:#94E2D5;--shiki-dark:#179299">:=</span><span style="color:#CBA6F7;--shiki-dark:#8839EF"> range</span><span style="color:#CDD6F4;--shiki-dark:#4C4F69"> data </span><span style="color:#9399B2;--shiki-dark:#7C7F93">{</span></span>
<span class="line"><span style="color:#CDD6F4;--shiki-dark:#4C4F69">    sum </span><span style="color:#94E2D5;--shiki-dark:#179299">+=</span><span style="color:#CDD6F4;--shiki-dark:#4C4F69"> data</span><span style="color:#9399B2;--shiki-dark:#7C7F93">[</span><span style="color:#CDD6F4;--shiki-dark:#4C4F69">i</span><span style="color:#9399B2;--shiki-dark:#7C7F93">]</span></span>
<span class="line"><span style="color:#9399B2;--shiki-dark:#7C7F93">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6C7086;font-style:italic;--shiki-dark:#9CA0B0;--shiki-dark-font-style:italic">// Slow: random access, one cache miss per access</span></span>
<span class="line"><span style="color:#CBA6F7;--shiki-dark:#8839EF">for</span><span style="color:#CDD6F4;--shiki-dark:#4C4F69"> _</span><span style="color:#9399B2;--shiki-dark:#7C7F93">,</span><span style="color:#CDD6F4;--shiki-dark:#4C4F69"> idx </span><span style="color:#94E2D5;--shiki-dark:#179299">:=</span><span style="color:#CBA6F7;--shiki-dark:#8839EF"> range</span><span style="color:#CDD6F4;--shiki-dark:#4C4F69"> randomIndices </span><span style="color:#9399B2;--shiki-dark:#7C7F93">{</span></span>
<span class="line"><span style="color:#CDD6F4;--shiki-dark:#4C4F69">    sum </span><span style="color:#94E2D5;--shiki-dark:#179299">+=</span><span style="color:#CDD6F4;--shiki-dark:#4C4F69"> data</span><span style="color:#9399B2;--shiki-dark:#7C7F93">[</span><span style="color:#CDD6F4;--shiki-dark:#4C4F69">idx</span><span style="color:#9399B2;--shiki-dark:#7C7F93">]</span></span>
<span class="line"><span style="color:#9399B2;--shiki-dark:#7C7F93">}</span></span></code></pre>
<p>Green Tea exploits this. By scanning objects within the same 8 KB span, it turns random jumps into sequential reads.</p>
<h3 id="the-prefetcher-your-cpu-tries-to-help">The prefetcher: your CPU tries to help</h3>
<p>Modern CPUs watch your memory access patterns. If you’re reading addresses 0, 64, 128, 192… the CPU guesses you’ll want 256 next and starts fetching it before you ask. This is <strong>prefetching</strong>.</p>
<p>Prefetchers are good at predictable patterns. Sequential reads, strided access, anything regular. They’re useless for random access because there’s nothing to predict.</p>
<p>The old GC defeated prefetching by jumping between random objects. Green Tea’s span-based approach gives the prefetcher something to work with.</p>
<h3 id="locality-why-nearby-matters">Locality: why nearby matters</h3>
<p><strong>Spatial locality</strong>: if you access address X, you’ll probably access X+1 soon. Arrays have great spatial locality. Linked lists don’t.</p>
<p><strong>Temporal locality</strong>: if you accessed address X recently, you’ll probably access it again. Loop variables have great temporal locality.</p>
<p>Green Tea improves spatial locality by grouping work into 8 KB regions. Instead of jumping across the heap, the GC processes objects that are physically near each other in memory.</p>
<h3 id="memory-stalls-the-hidden-cost">Memory stalls: the hidden cost</h3>
<p>When the CPU needs data that isn’t cached, it stalls. The pipeline stops. Cycles pass with nothing happening. This is a <strong>memory stall</strong>.</p>
<p>The Go team measured that >35% of GC cycles were memory stalls. The CPU wasn’t computing slowly. It was waiting.</p>
<p>You can’t see memory stalls in a profile. They hide inside innocent-looking functions. The only clue is that your code runs slower than the instruction count suggests.</p>
<h3 id="it-matters-anyway">It matters anyway</h3>
<p>These concepts apply beyond GC:</p>
<ul>
<li><strong>Prefer arrays over pointer-heavy structures</strong> when possible. Slices beat linked lists for cache behavior.</li>
<li><strong>Process data sequentially</strong> rather than jumping around.</li>
<li><strong>Keep related data together</strong>. If you always access fields A and B together, put them in the same struct.</li>
<li><strong>Batch operations</strong> instead of processing one item at a time.</li>
</ul>
<p>Green Tea is the Go runtime learning the same lessons your code should learn: work with the hardware, not against it.</p>  </main> <button id="back-to-top-btn" aria-label="back to top" class="z-50" data-astro-cid-xuhzuiaq> <svg viewBox="0 0 32 32" aria-hidden="true" focusable="false" data-astro-cid-xuhzuiaq="true" class="w-7 h-7 sm:w-5 s:h-6" astro-icon="carbon:arrow-up"><path fill="currentColor" d="M16 4 6 14l1.41 1.41L15 7.83V28h2V7.83l7.59 7.58L26 14 16 4z"/></svg> </button>  <script type="module">const e=document.getElementById("back-to-top-btn");e&&(e.addEventListener("click",()=>{document.body.scrollTop=0,document.documentElement.scrollTop=0}),window.addEventListener("scroll",()=>{window.scrollY<document.documentElement.clientHeight?(e.classList.remove("fade-in"),e.classList.add("fade-out"),e.style.display="flex"):(e.classList.remove("fade-out"),e.classList.add("fade-in"))}));</script> </article>   <aside class="hidden sm:block"> <div class="flex flex-col space-y-2"> <h2 class="font-semibold text-lg text-textColor">Alex Rios</h2> <p>alexrios.me</p> <div class="flex flex-wrap items-end gap-x-4"> <ul class="flex flex-wrap flex-1 items-center gap-x-2 sm:flex-initial"> <li class="flex"> <a class="inline-block p-1 sm:hover:text-accent hover:animate-spin" href="https://github.com/alexrios" target="_blank" rel="noopener noreferrer" title="Github"> <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false" class="h-5 w-5" astro-icon="mdi:github"><path fill="currentColor" d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2z"/></svg> <span class="sr-only">Github</span> </a> </li><li class="flex"> <a class="inline-block p-1 sm:hover:text-accent hover:animate-spin" href="https://linkedin.com/in/the-alex-rios" target="_blank" rel="noopener noreferrer" title="LinkedIn"> <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false" class="h-5 w-5" astro-icon="mdi:linkedin"><path fill="currentColor" d="M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14m-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93h2.79M6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37h2.77z"/></svg> <span class="sr-only">LinkedIn</span> </a> </li><li class="flex"> <a class="inline-block p-1 sm:hover:text-accent hover:animate-spin" href="https://x.com/alextrending" target="_blank" rel="noopener noreferrer" title="twitter"> <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false" class="h-5 w-5" astro-icon="mdi:twitter"><path fill="currentColor" d="M22.46 6c-.77.35-1.6.58-2.46.69.88-.53 1.56-1.37 1.88-2.38-.83.5-1.75.85-2.72 1.05C18.37 4.5 17.26 4 16 4c-2.35 0-4.27 1.92-4.27 4.29 0 .34.04.67.11.98C8.28 9.09 5.11 7.38 3 4.79c-.37.63-.58 1.37-.58 2.15 0 1.49.75 2.81 1.91 3.56-.71 0-1.37-.2-1.95-.5v.03c0 2.08 1.48 3.82 3.44 4.21a4.22 4.22 0 0 1-1.93.07 4.28 4.28 0 0 0 4 2.98 8.521 8.521 0 0 1-5.33 1.84c-.34 0-.68-.02-1.02-.06C3.44 20.29 5.7 21 8.12 21 16 21 20.33 14.46 20.33 8.79c0-.19 0-.37-.01-.56.84-.6 1.56-1.36 2.14-2.23z"/></svg> <span class="sr-only">twitter</span> </a> </li><li class="flex"> <a class="inline-block p-1 sm:hover:text-accent hover:animate-spin" href="/rss.xml" target="_blank" rel="noopener noreferrer" title="rss"> <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false" class="h-5 w-5" astro-icon="mdi:rss"><path fill="currentColor" d="M6.18 15.64a2.18 2.18 0 0 1 2.18 2.18C8.36 19 7.38 20 6.18 20 5 20 4 19 4 17.82a2.18 2.18 0 0 1 2.18-2.18M4 4.44A15.56 15.56 0 0 1 19.56 20h-2.83A12.73 12.73 0 0 0 4 7.27V4.44m0 5.66a9.9 9.9 0 0 1 9.9 9.9h-2.83A7.07 7.07 0 0 0 4 12.93V10.1z"/></svg> <span class="sr-only">rss</span> </a> </li> </ul> </div> <span class="!my-4 text-accent" aria-hidden>---</span>
                    <p> Why Go&#39;s new garbage collector works with pages instead of objects—and what that means for your applications </p> <div class="pt-2 hidden md:block"> <span>Part of series: </span> <br> <ul> <li><a class="cody-link" href="/series/Green Tea GC">Green Tea GC</a></li> </ul> </div>  </div> <nav class="sticky top-20 order-2 hidden basis-64 lg:block"> <hr> <h2 class="font-bold text-lg">Table of Contents</h2> <ul class="-me-32" id="toc"> <li data-astro-cid-zekvapgs> <a href="#the-problem-everyone-ignores" id="toc-the-problem-everyone-ignores" data-astro-cid-zekvapgs> The problem everyone ignores </a>  </li> <li data-astro-cid-zekvapgs> <a href="#the-non-solution-go-faster" id="toc-the-non-solution-go-faster" data-astro-cid-zekvapgs> The non-solution: go faster </a>  </li> <li data-astro-cid-zekvapgs> <a href="#the-insight-change-what-you-work-on" id="toc-the-insight-change-what-you-work-on" data-astro-cid-zekvapgs> The insight: change what you work on </a>  </li> <li data-astro-cid-zekvapgs> <a href="#what-this-means-in-practice" id="toc-what-this-means-in-practice" data-astro-cid-zekvapgs> What this means in practice </a>  </li> <li data-astro-cid-zekvapgs> <a href="#the-status" id="toc-the-status" data-astro-cid-zekvapgs> The status </a>  </li> <li data-astro-cid-zekvapgs> <a href="#why-this-matters-beyond-gc" id="toc-why-this-matters-beyond-gc" data-astro-cid-zekvapgs> Why this matters beyond GC </a>  </li> <li data-astro-cid-zekvapgs> <a href="#appendix-the-hardware-concepts" id="toc-appendix-the-hardware-concepts" data-astro-cid-zekvapgs> Appendix: the hardware concepts </a> <ul class="ml-2" data-astro-cid-zekvapgs> <li data-astro-cid-zekvapgs> <a href="#cache-your-cpus-short-term-memory" id="toc-cache-your-cpus-short-term-memory" data-astro-cid-zekvapgs> Cache: your CPU’s short-term memory </a>  </li> <li data-astro-cid-zekvapgs> <a href="#cache-lines-memory-comes-in-chunks" id="toc-cache-lines-memory-comes-in-chunks" data-astro-cid-zekvapgs> Cache lines: memory comes in chunks </a>  </li> <li data-astro-cid-zekvapgs> <a href="#the-prefetcher-your-cpu-tries-to-help" id="toc-the-prefetcher-your-cpu-tries-to-help" data-astro-cid-zekvapgs> The prefetcher: your CPU tries to help </a>  </li> <li data-astro-cid-zekvapgs> <a href="#locality-why-nearby-matters" id="toc-locality-why-nearby-matters" data-astro-cid-zekvapgs> Locality: why nearby matters </a>  </li> <li data-astro-cid-zekvapgs> <a href="#memory-stalls-the-hidden-cost" id="toc-memory-stalls-the-hidden-cost" data-astro-cid-zekvapgs> Memory stalls: the hidden cost </a>  </li> <li data-astro-cid-zekvapgs> <a href="#it-matters-anyway" id="toc-it-matters-anyway" data-astro-cid-zekvapgs> It matters anyway </a>  </li>  </ul> </li>  </ul> </nav> <script type="module">const c=document.getElementById("toc");c&&c?.addEventListener("click",t=>{const n=window.location.hash.slice(1),e=document.getElementById(`toc-${n}`);e instanceof HTMLElement&&e?.classList.remove("active-toc"),t.target instanceof HTMLElement&&t.target.classList.add("active-toc")});</script> </aside> </main> <footer class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold sm:flex-row sm:justify-between sm:text-xs text-textColor mb-8"> <div class="mr-2 sm:mr-0">
Copyright &copy; 2026  Alex Rios </div> <nav aria-label="More on this site" class="gap-x-0 sm:gap-x-2 sm:flex sm:divide-x sm:divide-accent"> <a href="/" class="px-2 py-0 hover:text-textColor hover:underline sm:px-4 sm:py-2"> Home </a><a href="/about" class="px-2 py-0 hover:text-textColor hover:underline sm:px-4 sm:py-2"> About </a><a href="/blog" class="px-2 py-0 hover:text-textColor hover:underline sm:px-4 sm:py-2"> Blog </a><a href="/books" class="px-2 py-0 hover:text-textColor hover:underline sm:px-4 sm:py-2"> Books </a><a href="/speaker" class="px-2 py-0 hover:text-textColor hover:underline sm:px-4 sm:py-2"> Speaker </a><a href="/archive" class="px-2 py-0 hover:text-textColor hover:underline sm:px-4 sm:py-2"> Archive </a> </nav> </footer> </body></html> <script type="module">const n='<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"><path fill="currentColor" d="M6 19V1h9l6 6v12zm8-11h5l-5-5zM2 23V7h2v14h11v2z"/></svg>',i=Array.from(document.querySelectorAll("pre.astro-code"));for(const t of i){let o=t.parentElement;if(o){let c=document.createElement("div");o.replaceChild(c,t),c.classList.add("relative"),c.appendChild(t);const e=document.createElement("button");e.className="cody-copy-code",e.innerHTML=n,e.title="Copy code block",t.setAttribute("tabindex","0"),c.appendChild(e),e.addEventListener("click",async()=>{await r(t,e)})}}async function r(t,o){const e=t.querySelector("code")?.innerText??"";await navigator.clipboard.writeText(e),o.innerText="Code Copied",setTimeout(()=>{o.innerHTML=n},700)}</script>