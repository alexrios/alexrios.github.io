<!DOCTYPE html><html lang="en" class="dark"> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" href="/icon.png"><meta name="generator" content="Astro v5.5.2"><!-- Font preloads --><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Space+Mono:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet"><!-- Canonical URL --><link rel="canonical" href="https://alexrios.me/blog/goroutine-leak-detection-orphans/"><!-- Primary Meta Tags --><title>When goroutines become orphans | alexrios</title><meta name="title" content="When goroutines become orphans"><meta name="description" content="Understanding goroutine leaks through a parent lens"><meta name="author" content="Alex Rios"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://alexrios.me/blog/goroutine-leak-detection-orphans/"><meta property="og:title" content="When goroutines become orphans"><meta property="og:description" content="Understanding goroutine leaks through a parent lens"><meta property="og:image" content="https://alexrios.me/og-image/goroutine-leak-detection-orphans.png"><meta property="article:author" content="Alex Rios"><meta property="article:published_time" content="2025-12-19T03:00:00.000Z"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://alexrios.me/blog/goroutine-leak-detection-orphans/"><meta property="twitter:title" content="When goroutines become orphans"><meta property="twitter:description" content="Understanding goroutine leaks through a parent lens"><meta property="twitter:image" content="https://alexrios.me/og-image/goroutine-leak-detection-orphans.png"><link rel="stylesheet" href="/_astro/about.BXhEje_b.css">
<link rel="stylesheet" href="/_astro/about.CGKMQgMR.css">
<style>li[data-astro-cid-zekvapgs]:before{content:"#";margin-right:-.5rem;color:var(--theme-accent)}.active-toc[data-astro-cid-zekvapgs]{color:var(--theme-accent)}button[data-astro-cid-xuhzuiaq]{position:fixed;bottom:1rem;left:82%;display:none;height:3rem;width:3rem;align-items:center;justify-content:center;border-radius:9999px;background-color:var(--theme-accent);color:var(--theme-bg);--tw-shadow: 0 1px 3px 0 rgb(0 0 0 / .1), 0 1px 2px -1px rgb(0 0 0 / .1);--tw-shadow-colored: 0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow);transition-property:all;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}button[data-astro-cid-xuhzuiaq]:hover{--tw-scale-x: 1.25;--tw-scale-y: 1.25;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y));--tw-shadow: 0 20px 25px -5px rgb(0 0 0 / .1), 0 8px 10px -6px rgb(0 0 0 / .1);--tw-shadow-colored: 0 20px 25px -5px var(--tw-shadow-color), 0 8px 10px -6px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}@media (min-width: 640px){button[data-astro-cid-xuhzuiaq]{bottom:2rem;height:2.5rem;width:2.5rem}}@media (min-width: 768px){button[data-astro-cid-xuhzuiaq]{left:90%}}@media (min-width: 1536px){button[data-astro-cid-xuhzuiaq]{left:75%}}
</style></head> <body> <header class="group relative mb-8 flex justify-between items-center gap-4" id="main-header" data-astro-cid-3ef6ksr2> <div class="block" data-astro-cid-3ef6ksr2> <a class="title whitespace-nowrap" href="/" aria-current="false" data-astro-cid-3ef6ksr2>alexrios</a> </div> <nav class="mt-4 bg-surface/95 sm:bg-bgColor absolute hidden top-8 w-full sm:block sm:static sm:mt-0 group-[.menu-open]:z-50 group-[.menu-open]:flex group-[.menu-open]:bg-bgColor" id="navigation-menu" aria-label="main menu" data-astro-cid-3ef6ksr2> <div class="space-y-1 px-2 pb-3 pt-2 sm:flex sm:px-0 sm:py-0 sm:space-y-0 sm:space-x-2" data-astro-cid-3ef6ksr2> <a href="/" class="block py-2 sm:py-0" title="Home" aria-current="false" data-astro-prefetch="true" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> Home </a> <a href="/about" class="block py-2 sm:py-0" title="About" aria-current="false" data-astro-prefetch="true" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> About </a> <a href="/blog" class="block py-2 sm:py-0" title="Blog" aria-current="false" data-astro-prefetch="true" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> Blog </a> <a href="/books" class="block py-2 sm:py-0" title="Books" aria-current="false" data-astro-prefetch="true" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> Books </a> <a href="/speaker" class="block py-2 sm:py-0" title="Speaker" aria-current="false" data-astro-prefetch="true" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> Speaker </a> <a href="/archive" class="block py-2 sm:py-0" title="Archive" aria-current="false" data-astro-prefetch="true" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> Archive </a>  <a href="/tags" class="sm:hidden block py-2 sm:py-0" title="tags" aria-current="false" data-astro-prefetch="true" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> Tags </a>  <a href="/series" class="sm:hidden block py-2 sm:py-0" title="series" aria-current="false" data-astro-prefetch="true" data-astro-cid-3ef6ksr2="true" data-astro-cid-eimmu3lg> Series </a>  </div> </nav> <div class="flex gap-2 items-center justify-center" data-astro-cid-3ef6ksr2> <button id="themeToggle" class="transition-all relative" aria-label="toggle theme" data-astro-cid-x3pjskd3> <svg width="25px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" data-astro-cid-x3pjskd3> <path class="sun opacity-100 transition-all dark:scale-0 dark:opacity-0" fill-rule="evenodd" d="M12 17.5a5.5 5.5 0 1 0 0-11 5.5 5.5 0 0 0 0 11zm0 1.5a7 7 0 1 0 0-14 7 7 0 0 0 0 14zm12-7a.8.8 0 0 1-.8.8h-2.4a.8.8 0 0 1 0-1.6h2.4a.8.8 0 0 1 .8.8zM4 12a.8.8 0 0 1-.8.8H.8a.8.8 0 0 1 0-1.6h2.5a.8.8 0 0 1 .8.8zm16.5-8.5a.8.8 0 0 1 0 1l-1.8 1.8a.8.8 0 0 1-1-1l1.7-1.8a.8.8 0 0 1 1 0zM6.3 17.7a.8.8 0 0 1 0 1l-1.7 1.8a.8.8 0 1 1-1-1l1.7-1.8a.8.8 0 0 1 1 0zM12 0a.8.8 0 0 1 .8.8v2.5a.8.8 0 0 1-1.6 0V.8A.8.8 0 0 1 12 0zm0 20a.8.8 0 0 1 .8.8v2.4a.8.8 0 0 1-1.6 0v-2.4a.8.8 0 0 1 .8-.8zM3.5 3.5a.8.8 0 0 1 1 0l1.8 1.8a.8.8 0 1 1-1 1L3.5 4.6a.8.8 0 0 1 0-1zm14.2 14.2a.8.8 0 0 1 1 0l1.8 1.7a.8.8 0 0 1-1 1l-1.8-1.7a.8.8 0 0 1 0-1z" data-astro-cid-x3pjskd3></path> <path class="moon opacity-0 transition-all dark:scale-100 dark:opacity-100" fill-rule="evenodd" d="M16.5 6A10.5 10.5 0 0 1 4.7 16.4 8.5 8.5 0 1 0 16.4 4.7l.1 1.3zm-1.7-2a9 9 0 0 1 .2 2 9 9 0 0 1-11 8.8 9.4 9.4 0 0 1-.8-.3c-.4 0-.8.3-.7.7a10 10 0 0 0 .3.8 10 10 0 0 0 9.2 6 10 10 0 0 0 4-19.2 9.7 9.7 0 0 0-.9-.3c-.3-.1-.7.3-.6.7a9 9 0 0 1 .3.8z" data-astro-cid-x3pjskd3></path> </svg> </button>  <script>
  const theme = (() => {
    if (typeof localStorage !== 'undefined' && localStorage.getItem('theme')) {
      return localStorage.getItem('theme');
    }
    if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
      return 'dark';
    }
      return 'light';
  })();

  if (theme === 'light') {
    document.documentElement.classList.remove('dark');
  } else {
    document.documentElement.classList.add('dark');
  }

  window.localStorage.setItem('theme', theme);

  const handleToggleClick = () => {
    const element = document.documentElement;
    element.classList.toggle("dark");

    const isDark = element.classList.contains("dark");
    localStorage.setItem("theme", isDark ? "dark" : "light");
  }

  document.getElementById("themeToggle").addEventListener("click", handleToggleClick);
</script> <nav-button data-astro-cid-3ef6ksr2="true"> <div class="sm:hidden" data-astro-cid-3ef6ksr2> <span class="sr-only" data-astro-cid-3ef6ksr2>open main menu</span> <button class="group flex items-center justify-center" type="button" id="navigation-menu-btn" aria-label="Open main menu" aria-expanded="false" aria-haspopup="menu" data-astro-cid-3ef6ksr2> <!-- icon when menu is closed --> <svg class="transform transition-all duration-150 ease-out group-aria-expanded:scale-0 group-aria-expanded:opacity-0 h-6 w-6 block group-aria-expanded:hidden" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-astro-cid-3ef6ksr2> <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" data-astro-cid-3ef6ksr2></path> </svg> <!-- icon when menu is open --> <svg class="transform transition-all duration-150 ease-out h-6 w-6 scale-0 text-accent opacity-0 transition-all group-aria-expanded:scale-100 group-aria-expanded:opacity-100 hidden group-aria-expanded:block" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-astro-cid-3ef6ksr2> <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" data-astro-cid-3ef6ksr2></path> </svg> </button> </div> </nav-button> </div> </header>  <script type="module">class e extends HTMLElement{headerEl;mobileButtonEl;menuOpen;constructor(){super(),this.headerEl=document.getElementById("main-header"),this.mobileButtonEl=this.querySelector("button"),this.menuOpen=!1,this.mobileButtonEl.addEventListener("click",this.toggleMobileMenu)}toggleMobileMenu=()=>{this.headerEl.classList.toggle("menu-open"),this.menuOpen=!this.menuOpen,this.mobileButtonEl.setAttribute("aria-expanded",this.menuOpen.toString())}}customElements.define("nav-button",e);</script> <main class="grid grid-cols-1 gap-y-16 sm:grid-cols-[3fr_1fr] sm:gap-x-4">  <article class="cody-bg prose dark:prose-invert prose-cody text-textColor max-w-4xl"> <header class="space-y-2"> <div class="aspect-h-9 aspect-w-16 mb-6 w-full flex justify-center"> <img src="/orphan-goroutine.png" alt="orphaned goroutine illustration" class="m-0"> </div> <div class="md:sr-only not-sr-only"> <span>Part of series:</span> <a class="cody-link" href="/series/Goroutine Leak Detection">Goroutine Leak Detection</a> </div> <div class="flex gap-2 items-center"> <h1 class="text-3xl my-0">When goroutines become orphans</h1>  </div> <span class="font-semibold text-textColor flex gap-2 items-center"> <time datetime="2025-12-19T03:00:00.000Z" title="19 December 2025"> 19 December 2025 </time> <span>
/ 4 min read </span>  </span> <ul class="not-prose flex gap-2 flex-wrap"> <svg viewBox="0 0 32 32" aria-hidden="true" focusable="false" class="w-5 h-5" astro-icon="carbon:tag-group"><circle cx="10" cy="14" r="2" fill="currentColor"/><path fill="currentColor" d="M16 30a1 1 0 0 1-.71-.29L4.59 19A2 2 0 0 1 4 17.59V10a2 2 0 0 1 2-2h7.59a2 2 0 0 1 1.41.59l10.71 10.7a1 1 0 0 1 0 1.42l-9 9A1 1 0 0 1 16 30zM6 10v7.59l10 10L23.59 20l-10-10z"/><path fill="currentColor" d="M27.71 13.29 17 2.59A2 2 0 0 0 15.59 2H8a2 2 0 0 0-2 2v2h2V4h7.59l10 10-1.3 1.29 1.42 1.42 2-2a1 1 0 0 0 0-1.42z"/></svg> <li class="tag"> <a href="/tags/go">go</a> </li><li class="tag"> <a href="/tags/concurrency">concurrency</a> </li><li class="tag"> <a href="/tags/beginners">beginners</a> </li><li class="tag"> <a href="/tags/goroutines">goroutines</a> </li> </ul> </header> <hr class="my-4"> <main class="prose-headings:font-semibold prose-headings:ml-4 prose-headings:before:absolute prose-headings:before:-ms-4 prose-headings:before:text-accent prose-headings:before:content-['#'] prose-th:before:content-none prose-a:text-accent">  <p>You spawn a goroutine. It starts running. Then it waits. And waits. And waits.</p>
<p>Meanwhile, your program moves on. The function that created that goroutine returns. Life continues. But somewhere in the background, that goroutine is still there. Waiting for something that will never come.</p>
<p>It’s not crashed. It’s not dead. It’s just… stuck. Forever. An <strong>orphan</strong>.</p>
<h2 id="the-parent-child-relationship">The parent-child relationship</h2>
<p>Here’s a mental model that will save you hours of debugging:</p>
<p><strong>When you spawn a goroutine, liking it or not, you become a parent. Congratulations!</strong></p>
<pre class="astro-code astro-code-themes catppuccin-mocha catppuccin-latte" style="background-color:#1e1e2e;--shiki-dark-bg:#eff1f5;color:#cdd6f4;--shiki-dark:#4c4f69; overflow-x: auto;" tabindex="0" data-language="go"><code><span class="line"><span style="color:#CBA6F7;--shiki-dark:#8839EF">go</span><span style="color:#CBA6F7;--shiki-dark:#8839EF"> func</span><span style="color:#9399B2;--shiki-dark:#7C7F93">()</span><span style="color:#9399B2;--shiki-dark:#7C7F93"> {</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic;--shiki-dark:#9CA0B0;--shiki-dark-font-style:italic">    // This is your child</span></span>
<span class="line"><span style="color:#9399B2;--shiki-dark:#7C7F93">}()</span></span></code></pre>
<p>And like any responsible parent, you have obligations. Your child needs to be able to finish its work and go home. If you leave before making sure that can happen, you’ve abandoned them.</p>
<p>Think of it like dropping your kid at a bus stop:</p>
<blockquote>
<p>Wait here. A bus will come and pick you up</p>
</blockquote>
<p>Then you drive away. But what if the bus was cancelled? What if nobody told your kid? They’ll stand there forever, waiting for a bus that will never arrive.</p>
<p>That’s a goroutine leak.</p>
<h2 id="the-simplest-leak">The simplest leak</h2>
<p>Let’s see what this looks like in code:</p>
<pre class="astro-code astro-code-themes catppuccin-mocha catppuccin-latte" style="background-color:#1e1e2e;--shiki-dark-bg:#eff1f5;color:#cdd6f4;--shiki-dark:#4c4f69; overflow-x: auto;" tabindex="0" data-language="go"><code><span class="line"><span style="color:#CBA6F7;--shiki-dark:#8839EF">func</span><span style="color:#89B4FA;font-style:italic;--shiki-dark:#1E66F5;--shiki-dark-font-style:italic"> leakyFunction</span><span style="color:#9399B2;--shiki-dark:#7C7F93">()</span><span style="color:#9399B2;--shiki-dark:#7C7F93"> {</span></span>
<span class="line"><span style="color:#CDD6F4;--shiki-dark:#4C4F69">    ch </span><span style="color:#94E2D5;--shiki-dark:#179299">:=</span><span style="color:#89B4FA;font-style:italic;--shiki-dark:#1E66F5;--shiki-dark-font-style:italic"> make</span><span style="color:#9399B2;--shiki-dark:#7C7F93">(</span><span style="color:#CBA6F7;--shiki-dark:#8839EF">chan</span><span style="color:#CBA6F7;--shiki-dark:#8839EF"> int</span><span style="color:#9399B2;--shiki-dark:#7C7F93">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CBA6F7;--shiki-dark:#8839EF">    go</span><span style="color:#CBA6F7;--shiki-dark:#8839EF"> func</span><span style="color:#9399B2;--shiki-dark:#7C7F93">()</span><span style="color:#9399B2;--shiki-dark:#7C7F93"> {</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic;--shiki-dark:#9CA0B0;--shiki-dark-font-style:italic">        // Child: "I'll send this value and wait for someone to receive it"</span></span>
<span class="line"><span style="color:#CDD6F4;--shiki-dark:#4C4F69">        ch </span><span style="color:#94E2D5;--shiki-dark:#179299">&#x3C;-</span><span style="color:#FAB387;--shiki-dark:#FE640B"> 42</span></span>
<span class="line"><span style="color:#9399B2;--shiki-dark:#7C7F93">    }()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6C7086;font-style:italic;--shiki-dark:#9CA0B0;--shiki-dark-font-style:italic">    // Parent: leaves immediately</span></span>
<span class="line"><span style="color:#CBA6F7;--shiki-dark:#8839EF">    return</span></span>
<span class="line"><span style="color:#9399B2;--shiki-dark:#7C7F93">}</span></span></code></pre>
<p>What happens here?</p>
<ol>
<li>You create a channel</li>
<li>You spawn a child goroutine that tries to send <code>42</code> to that channel</li>
<li>You return immediately</li>
</ol>
<p>The child tries to send… but who’s receiving? Nobody. The channel is <strong>unbuffered</strong>, which means the sender blocks until a receiver is ready. But you, the parent, just left. The function returned. The local variable <code>ch</code> is gone.</p>
<p>Your child is now an orphan, blocked forever on a send that will never complete.</p>
<pre class="astro-code astro-code-themes catppuccin-mocha catppuccin-latte" style="background-color:#1e1e2e;--shiki-dark-bg:#eff1f5;color:#cdd6f4;--shiki-dark:#4c4f69; overflow-x: auto;" tabindex="0" data-language="xml"><code><span class="line"><span style="color:#CDD6F4;--shiki-dark:#4C4F69">Parent goroutine              Child goroutine</span></span>
<span class="line"><span style="color:#CDD6F4;--shiki-dark:#4C4F69">       |                             |</span></span>
<span class="line"><span style="color:#CDD6F4;--shiki-dark:#4C4F69">       |-------- go func() --------->|</span></span>
<span class="line"><span style="color:#CDD6F4;--shiki-dark:#4C4F69">       |                             |</span></span>
<span class="line"><span style="color:#CDD6F4;--shiki-dark:#4C4F69">       | return                      | ch </span><span style="color:#94E2D5;--shiki-dark:#179299">&#x3C;</span><span style="color:#89B4FA;--shiki-dark:#1E66F5">-</span><span style="color:#CDD6F4;--shiki-dark:#4C4F69"> 42</span></span>
<span class="line"><span style="color:#CDD6F4;--shiki-dark:#4C4F69">       X                             | (blocked...)</span></span>
<span class="line"><span style="color:#CDD6F4;--shiki-dark:#4C4F69">                                     | (blocked...)</span></span>
<span class="line"><span style="color:#CDD6F4;--shiki-dark:#4C4F69">                                     | (blocked forever)</span></span></code></pre>
<p>The parent’s timeline ends. The child’s never does.</p>
<h2 id="okay-one-stuck-goroutine-so-what">Okay, one stuck goroutine. So what?</h2>
<p>I have news for you: <strong>Go doesn’t have a goroutine garbage collector.</strong></p>
<p>The runtime is excellent at cleaning up unused memory. Objects that nobody references get swept away. <strong>But goroutines aren’t objects</strong>. A stuck goroutine is still “running” from the runtime’s perspective. It’s just running a blocking operation that happens to take forever.</p>
<p>Each orphaned goroutine holds onto:</p>
<ul>
<li>Its stack (minimum 2KB, can grow much larger)</li>
<li>Any variables it captured</li>
<li>Any resources it opened</li>
</ul>
<p>In a server handling thousands of requests per second, if each request has even a small chance of orphaning a goroutine, you’re accumulating dead weight. Over hours or days, memory climbs. Eventually, things break.</p>
<p>The worst part? These leaks are silent. No crash. No error. Just a slow accumulation of abandoned children (A.K.A. slow degradation).</p>
<h2 id="the-responsible-parent">The responsible parent</h2>
<p>So how do you avoid creating orphans? Give your children a way to know when you’re leaving.</p>
<p>The most common approach: <strong>context</strong>.</p>
<pre class="astro-code astro-code-themes catppuccin-mocha catppuccin-latte" style="background-color:#1e1e2e;--shiki-dark-bg:#eff1f5;color:#cdd6f4;--shiki-dark:#4c4f69; overflow-x: auto;" tabindex="0" data-language="go"><code><span class="line"><span style="color:#CBA6F7;--shiki-dark:#8839EF">func</span><span style="color:#89B4FA;font-style:italic;--shiki-dark:#1E66F5;--shiki-dark-font-style:italic"> responsibleFunction</span><span style="color:#9399B2;--shiki-dark:#7C7F93">(</span><span style="color:#EBA0AC;font-style:italic;--shiki-dark:#E64553;--shiki-dark-font-style:italic">ctx</span><span style="color:#F9E2AF;font-style:italic;--shiki-dark:#DF8E1D;--shiki-dark-font-style:italic"> context</span><span style="color:#9399B2;--shiki-dark:#7C7F93">.</span><span style="color:#F9E2AF;font-style:italic;--shiki-dark:#DF8E1D;--shiki-dark-font-style:italic">Context</span><span style="color:#9399B2;--shiki-dark:#7C7F93">)</span><span style="color:#9399B2;--shiki-dark:#7C7F93"> {</span></span>
<span class="line"><span style="color:#CDD6F4;--shiki-dark:#4C4F69">    ch </span><span style="color:#94E2D5;--shiki-dark:#179299">:=</span><span style="color:#89B4FA;font-style:italic;--shiki-dark:#1E66F5;--shiki-dark-font-style:italic"> make</span><span style="color:#9399B2;--shiki-dark:#7C7F93">(</span><span style="color:#CBA6F7;--shiki-dark:#8839EF">chan</span><span style="color:#CBA6F7;--shiki-dark:#8839EF"> int</span><span style="color:#9399B2;--shiki-dark:#7C7F93">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CBA6F7;--shiki-dark:#8839EF">    go</span><span style="color:#CBA6F7;--shiki-dark:#8839EF"> func</span><span style="color:#9399B2;--shiki-dark:#7C7F93">()</span><span style="color:#9399B2;--shiki-dark:#7C7F93"> {</span></span>
<span class="line"><span style="color:#CBA6F7;--shiki-dark:#8839EF">        select</span><span style="color:#9399B2;--shiki-dark:#7C7F93"> {</span></span>
<span class="line"><span style="color:#CBA6F7;--shiki-dark:#8839EF">        case</span><span style="color:#CDD6F4;--shiki-dark:#4C4F69"> ch </span><span style="color:#94E2D5;--shiki-dark:#179299">&#x3C;-</span><span style="color:#FAB387;--shiki-dark:#FE640B"> 42</span><span style="color:#9399B2;--shiki-dark:#7C7F93">:</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic;--shiki-dark:#9CA0B0;--shiki-dark-font-style:italic">            // Success: someone received our value</span></span>
<span class="line"><span style="color:#CBA6F7;--shiki-dark:#8839EF">        case</span><span style="color:#94E2D5;--shiki-dark:#179299"> &#x3C;-</span><span style="color:#CDD6F4;--shiki-dark:#4C4F69">ctx</span><span style="color:#9399B2;--shiki-dark:#7C7F93">.</span><span style="color:#89B4FA;font-style:italic;--shiki-dark:#1E66F5;--shiki-dark-font-style:italic">Done</span><span style="color:#9399B2;--shiki-dark:#7C7F93">():</span></span>
<span class="line"><span style="color:#6C7086;font-style:italic;--shiki-dark:#9CA0B0;--shiki-dark-font-style:italic">            // Parent is leaving, we should too</span></span>
<span class="line"><span style="color:#CBA6F7;--shiki-dark:#8839EF">            return</span></span>
<span class="line"><span style="color:#9399B2;--shiki-dark:#7C7F93">        }</span></span>
<span class="line"><span style="color:#9399B2;--shiki-dark:#7C7F93">    }()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6C7086;font-style:italic;--shiki-dark:#9CA0B0;--shiki-dark-font-style:italic">    // Even if we return early, the child has an escape route</span></span>
<span class="line"><span style="color:#CBA6F7;--shiki-dark:#8839EF">    return</span></span>
<span class="line"><span style="color:#9399B2;--shiki-dark:#7C7F93">}</span></span></code></pre>
<p>Now the child has two options: send the value, or notice that the context was cancelled and exit cleanly. The <code>select</code> statement lets it respond to whichever happens first.</p>
<pre class="astro-code astro-code-themes catppuccin-mocha catppuccin-latte" style="background-color:#1e1e2e;--shiki-dark-bg:#eff1f5;color:#cdd6f4;--shiki-dark:#4c4f69; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>Parent goroutine              Child goroutine</span></span>
<span class="line"><span>       |                             |</span></span>
<span class="line"><span>       |-------- go func() --------->|</span></span>
<span class="line"><span>       |                             |</span></span>
<span class="line"><span>       | return                      | select {</span></span>
<span class="line"><span>       | cancel() ------------------>|   case &#x3C;-ctx.Done():</span></span>
<span class="line"><span>       X                             X     return</span></span></code></pre>
<p>Both timelines end. No orphans. Progress!</p>
<h2 id="the-three-questions">The three questions</h2>
<p>Before spawning any goroutine, ask yourself:</p>
<ol>
<li>
<p><strong>Who will receive from this channel?</strong>
If the answer is “maybe nobody,” you’re creating a potential orphan.</p>
</li>
<li>
<p><strong>How will this goroutine know when to stop?</strong>
Context cancellation, channel close, or some other signal. It needs an exit path.</p>
</li>
<li>
<p><strong>What happens if I return early?</strong>
Error paths are where orphans are born. That <code>if err != nil { return err }</code> might be abandoning a child.</p>
</li>
</ol>
<p>If you can answer these three questions confidently, you’re being a responsible parent. <em>No Office of <del>Children</del>goroutine’s Issues</em>.</p>
<h2 id="going-deeper">Going deeper</h2>
<p>This is the core concept. The parent-child relationship is the mental model that makes goroutine leaks click.</p>
<p>But there’s more to this story.</p>
<p>In Go 1.26, the runtime team introduced an <strong>experimental goroutine leak detector</strong>. It can actually tell you which goroutines are orphaned, not just that you have goroutines waiting, but which ones will never wake up.</p>
<p>The next post explores how this works, starting with a real-world example that shows just how easy it is to create orphans in production code.</p>
<hr>
<p><strong>Next</strong>: <a href="/blog/goroutine-leak-detection-intro">Hunting ghost goroutines →</a></p>  </main> <button id="back-to-top-btn" aria-label="back to top" class="z-50" data-astro-cid-xuhzuiaq> <svg viewBox="0 0 32 32" aria-hidden="true" focusable="false" data-astro-cid-xuhzuiaq="true" class="w-7 h-7 sm:w-5 s:h-6" astro-icon="carbon:arrow-up"><path fill="currentColor" d="M16 4 6 14l1.41 1.41L15 7.83V28h2V7.83l7.59 7.58L26 14 16 4z"/></svg> </button>  <script type="module">const e=document.getElementById("back-to-top-btn");e&&(e.addEventListener("click",()=>{document.body.scrollTop=0,document.documentElement.scrollTop=0}),window.addEventListener("scroll",()=>{window.scrollY<document.documentElement.clientHeight?(e.classList.remove("fade-in"),e.classList.add("fade-out"),e.style.display="flex"):(e.classList.remove("fade-out"),e.classList.add("fade-in"))}));</script> </article>   <aside class="hidden sm:block"> <div class="flex flex-col space-y-2"> <h2 class="font-semibold text-lg text-textColor">Alex Rios</h2> <p>alexrios.me</p> <div class="flex flex-wrap items-end gap-x-4"> <ul class="flex flex-wrap flex-1 items-center gap-x-2 sm:flex-initial"> <li class="flex"> <a class="inline-block p-1 sm:hover:text-accent hover:animate-spin" href="https://github.com/alexrios" target="_blank" rel="noopener noreferrer" title="Github"> <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false" class="h-5 w-5" astro-icon="mdi:github"><path fill="currentColor" d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2z"/></svg> <span class="sr-only">Github</span> </a> </li><li class="flex"> <a class="inline-block p-1 sm:hover:text-accent hover:animate-spin" href="https://linkedin.com/in/the-alex-rios" target="_blank" rel="noopener noreferrer" title="LinkedIn"> <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false" class="h-5 w-5" astro-icon="mdi:linkedin"><path fill="currentColor" d="M19 3a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h14m-.5 15.5v-5.3a3.26 3.26 0 0 0-3.26-3.26c-.85 0-1.84.52-2.32 1.3v-1.11h-2.79v8.37h2.79v-4.93c0-.77.62-1.4 1.39-1.4a1.4 1.4 0 0 1 1.4 1.4v4.93h2.79M6.88 8.56a1.68 1.68 0 0 0 1.68-1.68c0-.93-.75-1.69-1.68-1.69a1.69 1.69 0 0 0-1.69 1.69c0 .93.76 1.68 1.69 1.68m1.39 9.94v-8.37H5.5v8.37h2.77z"/></svg> <span class="sr-only">LinkedIn</span> </a> </li><li class="flex"> <a class="inline-block p-1 sm:hover:text-accent hover:animate-spin" href="https://x.com/alextrending" target="_blank" rel="noopener noreferrer" title="twitter"> <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false" class="h-5 w-5" astro-icon="mdi:twitter"><path fill="currentColor" d="M22.46 6c-.77.35-1.6.58-2.46.69.88-.53 1.56-1.37 1.88-2.38-.83.5-1.75.85-2.72 1.05C18.37 4.5 17.26 4 16 4c-2.35 0-4.27 1.92-4.27 4.29 0 .34.04.67.11.98C8.28 9.09 5.11 7.38 3 4.79c-.37.63-.58 1.37-.58 2.15 0 1.49.75 2.81 1.91 3.56-.71 0-1.37-.2-1.95-.5v.03c0 2.08 1.48 3.82 3.44 4.21a4.22 4.22 0 0 1-1.93.07 4.28 4.28 0 0 0 4 2.98 8.521 8.521 0 0 1-5.33 1.84c-.34 0-.68-.02-1.02-.06C3.44 20.29 5.7 21 8.12 21 16 21 20.33 14.46 20.33 8.79c0-.19 0-.37-.01-.56.84-.6 1.56-1.36 2.14-2.23z"/></svg> <span class="sr-only">twitter</span> </a> </li><li class="flex"> <a class="inline-block p-1 sm:hover:text-accent hover:animate-spin" href="/rss.xml" target="_blank" rel="noopener noreferrer" title="rss"> <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false" class="h-5 w-5" astro-icon="mdi:rss"><path fill="currentColor" d="M6.18 15.64a2.18 2.18 0 0 1 2.18 2.18C8.36 19 7.38 20 6.18 20 5 20 4 19 4 17.82a2.18 2.18 0 0 1 2.18-2.18M4 4.44A15.56 15.56 0 0 1 19.56 20h-2.83A12.73 12.73 0 0 0 4 7.27V4.44m0 5.66a9.9 9.9 0 0 1 9.9 9.9h-2.83A7.07 7.07 0 0 0 4 12.93V10.1z"/></svg> <span class="sr-only">rss</span> </a> </li> </ul> </div> <span class="!my-4 text-accent" aria-hidden>---</span>
                    <p> Understanding goroutine leaks through a parent lens </p> <div class="pt-2 hidden md:block"> <span>Part of series: </span> <br> <ul> <li><a class="cody-link" href="/series/Goroutine Leak Detection">Goroutine Leak Detection</a></li> </ul> </div>  </div> <nav class="sticky top-20 order-2 hidden basis-64 lg:block"> <hr> <h2 class="font-bold text-lg">Table of Contents</h2> <ul class="-me-32" id="toc"> <li data-astro-cid-zekvapgs> <a href="#the-parent-child-relationship" id="toc-the-parent-child-relationship" data-astro-cid-zekvapgs> The parent-child relationship </a>  </li> <li data-astro-cid-zekvapgs> <a href="#the-simplest-leak" id="toc-the-simplest-leak" data-astro-cid-zekvapgs> The simplest leak </a>  </li> <li data-astro-cid-zekvapgs> <a href="#okay-one-stuck-goroutine-so-what" id="toc-okay-one-stuck-goroutine-so-what" data-astro-cid-zekvapgs> Okay, one stuck goroutine. So what? </a>  </li> <li data-astro-cid-zekvapgs> <a href="#the-responsible-parent" id="toc-the-responsible-parent" data-astro-cid-zekvapgs> The responsible parent </a>  </li> <li data-astro-cid-zekvapgs> <a href="#the-three-questions" id="toc-the-three-questions" data-astro-cid-zekvapgs> The three questions </a>  </li> <li data-astro-cid-zekvapgs> <a href="#going-deeper" id="toc-going-deeper" data-astro-cid-zekvapgs> Going deeper </a>  </li>  </ul> </nav> <script type="module">const c=document.getElementById("toc");c&&c?.addEventListener("click",t=>{const n=window.location.hash.slice(1),e=document.getElementById(`toc-${n}`);e instanceof HTMLElement&&e?.classList.remove("active-toc"),t.target instanceof HTMLElement&&t.target.classList.add("active-toc")});</script> </aside> </main> <footer class="mt-auto flex w-full flex-col items-center justify-center gap-y-2 pb-4 pt-20 text-center align-top font-semibold sm:flex-row sm:justify-between sm:text-xs text-textColor mb-8"> <div class="mr-2 sm:mr-0">
Copyright &copy; 2025  Alex Rios </div> <nav aria-label="More on this site" class="gap-x-0 sm:gap-x-2 sm:flex sm:divide-x sm:divide-accent"> <a href="/" class="px-2 py-0 hover:text-textColor hover:underline sm:px-4 sm:py-2"> Home </a><a href="/about" class="px-2 py-0 hover:text-textColor hover:underline sm:px-4 sm:py-2"> About </a><a href="/blog" class="px-2 py-0 hover:text-textColor hover:underline sm:px-4 sm:py-2"> Blog </a><a href="/books" class="px-2 py-0 hover:text-textColor hover:underline sm:px-4 sm:py-2"> Books </a><a href="/speaker" class="px-2 py-0 hover:text-textColor hover:underline sm:px-4 sm:py-2"> Speaker </a><a href="/archive" class="px-2 py-0 hover:text-textColor hover:underline sm:px-4 sm:py-2"> Archive </a> </nav> </footer> </body></html> <script type="module">const n='<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"><path fill="currentColor" d="M6 19V1h9l6 6v12zm8-11h5l-5-5zM2 23V7h2v14h11v2z"/></svg>',i=Array.from(document.querySelectorAll("pre.astro-code"));for(const t of i){let o=t.parentElement;if(o){let c=document.createElement("div");o.replaceChild(c,t),c.classList.add("relative"),c.appendChild(t);const e=document.createElement("button");e.className="cody-copy-code",e.innerHTML=n,e.title="Copy code block",t.setAttribute("tabindex","0"),c.appendChild(e),e.addEventListener("click",async()=>{await r(t,e)})}}async function r(t,o){const e=t.querySelector("code")?.innerText??"";await navigator.clipboard.writeText(e),o.innerText="Code Copied",setTimeout(()=>{o.innerHTML=n},700)}</script>